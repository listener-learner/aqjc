<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PBS_TEST_REPORT" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.tyust.bean.pbs.PbsTestReport" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <result column="pbs_test_report_id" property="pbsTestReportId" jdbcType="VARCHAR" />
    <result column="pbs_apply_id" property="pbsApplyId" jdbcType="VARCHAR" />
    <result column="test_report_number" property="testReportNumber" jdbcType="VARCHAR" />
    <result column="test_user_name" property="testUserName" jdbcType="VARCHAR" />
    <result column="test_date" property="testDate" jdbcType="TIMESTAMP" />
    <result column="test_status" property="testStatus" jdbcType="CHAR" />
    
    <result column="pbs_test_sample_name" property="pbsTestSampleName" jdbcType="VARCHAR" />
    <result column="pbs_test_type_specification" property="pbsTestTypeSpecification" jdbcType="VARCHAR" />
    <result column="pbs_test_temperature" property="pbsTestTemperature" jdbcType="VARCHAR" />
    <result column="pbs_test_humidity" property="pbsTestHumidity" jdbcType="VARCHAR" />
    <result column="pbs_test_project" property="pbsTestProject" jdbcType="VARCHAR" />
    <result column="pbs_test_standard" property="pbsTestStandard" jdbcType="VARCHAR" />
    <result column="pbs_test_location" property="pbsTestLocation" jdbcType="VARCHAR" />
    <result column="pbs_test_grade" property="pbsTestGrade" jdbcType="VARCHAR" />
    <result column="pbs_test_conclusion" property="pbsTestConclusion" jdbcType="VARCHAR" />
    <result column="pbs_test_completion_time" property="pbsTestCompletionTime" jdbcType="DATE" />
    <result column="pbs_test_pbs_status" property="pbsTestPbsStatus" jdbcType="VARCHAR" />
    <result column="pbs_test_pbs_size" property="pbsTestPbsSize" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tyust.bean.pbs.PbsTestReportExample" >
   		<isParameterPresent>
			<isEqual property="pagination" compareValue="true">
	           <![CDATA[SELECT * FROM
				(
				SELECT A.*, ROWNUM RN
				FROM (
			   ]]>
			</isEqual>
		</isParameterPresent>
	
    select pbs_test_report_id, pbs_apply_id, test_report_number, test_user_name, test_date,
      test_status,pbs_test_sample_name,pbs_test_type_specification,
		pbs_test_temperature,
		pbs_test_humidity,
		pbs_test_project,
		pbs_test_standard,
		pbs_test_location,
		pbs_test_grade,
		pbs_test_conclusion,
		pbs_test_completion_time,
		pbs_test_pbs_status,
		pbs_test_pbs_size
    from PBS_TEST_REPORT
    <isParameterPresent >
      <include refid="PBS_TEST_REPORT.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
    <isParameterPresent>
		<isEqual property="pagination" compareValue="true">
            <![CDATA[
				) A
				WHERE ROWNUM <=#limit#
				)
				WHERE RN >#start#
			]]>
		</isEqual>
	</isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
      
   	 select pbs_test_report_id, pbs_apply_id, test_report_number, test_user_name, test_date,
      test_status,pbs_test_sample_name,pbs_test_type_specification,
		pbs_test_temperature,
		pbs_test_humidity,
		pbs_test_project,
		pbs_test_standard,
		pbs_test_location,
		pbs_test_grade,
		pbs_test_conclusion,
		pbs_test_completion_time,
		pbs_test_pbs_status,
		pbs_test_pbs_size
    from PBS_TEST_REPORT
    where pbs_test_report_id = #pbsTestReportId:VARCHAR#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from PBS_TEST_REPORT
    where pbs_test_report_id = #pbsTestReportId:VARCHAR#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.tyust.bean.pbs.PbsTestReportExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from PBS_TEST_REPORT
    <include refid="PBS_TEST_REPORT.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into PBS_TEST_REPORT (pbs_test_report_id, pbs_apply_id, test_report_number,
      test_user_name, test_date, test_status,PBS_TEST_SAMPLE_NAME,PBS_TEST_TYPE_SPECIFICATION,
      PBS_TEST_TEMPERATURE,PBS_TEST_HUMIDITY,PBS_TEST_PROJECT,PBS_TEST_STANDARD,PBS_TEST_LOCATION,
      PBS_TEST_GRADE,PBS_TEST_CONCLUSION,PBS_TEST_COMPLETION_TIME,PBS_TEST_PBS_STATUS,PBS_TEST_PBS_SIZE)
    values (#pbsTestReportId:VARCHAR#, #pbsApplyId:VARCHAR#, #testReportNumber:VARCHAR#,
      #testUserName:VARCHAR#, #testDate:TIMESTAMP#, #testStatus:CHAR#,
      #pbsTestSampleName:VARCHAR#,#pbsTestTypeSpecification:VARCHAR#,#pbsTestTemperature:VARCHAR#,
      #pbsTestHumidity:VARCHAR#,#pbsTestProject:VARCHAR#,#pbsTestStandard:VARCHAR#,#pbsTestLocation:VARCHAR#,
      #pbsTestGrade:VARCHAR#,#pbsTestConclusion:VARCHAR#,#pbsTestCompletionTime:DATE#,#pbsTestPbsStatus:VARCHAR#,
      #pbsTestPbsSize:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into PBS_TEST_REPORT
    <dynamic prepend="(" >
      <isNotNull prepend="," property="pbsTestReportId" >
        pbs_test_report_id
      </isNotNull>
      <isNotNull prepend="," property="pbsApplyId" >
        pbs_apply_id
      </isNotNull>
      <isNotNull prepend="," property="testReportNumber" >
        test_report_number
      </isNotNull>
      <isNotNull prepend="," property="testUserName" >
        test_user_name
      </isNotNull>
      <isNotNull prepend="," property="testDate" >
        test_date
      </isNotNull>
      <isNotNull prepend="," property="testStatus" >
        test_status
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="pbsTestReportId" >
        #pbsTestReportId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="pbsApplyId" >
        #pbsApplyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testReportNumber" >
        #testReportNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testUserName" >
        #testUserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testDate" >
        #testDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="testStatus" >
        #testStatus:CHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.tyust.bean.pbs.PbsTestReportExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select count(*) from PBS_TEST_REPORT
    <include refid="PBS_TEST_REPORT.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update PBS_TEST_REPORT
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.pbsTestReportId" >
        pbs_test_report_id = #record.pbsTestReportId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.pbsApplyId" >
        pbs_apply_id = #record.pbsApplyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.testReportNumber" >
        test_report_number = #record.testReportNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.testUserName" >
        test_user_name = #record.testUserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.testDate" >
        test_date = #record.testDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.testStatus" >
        test_status = #record.testStatus:CHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="PBS_TEST_REPORT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    update PBS_TEST_REPORT
    set pbs_test_report_id = #record.pbsTestReportId:VARCHAR#,
      pbs_apply_id = #record.pbsApplyId:VARCHAR#,
      test_report_number = #record.testReportNumber:VARCHAR#,
      test_user_name = #record.testUserName:VARCHAR#,
      test_date = #record.testDate:TIMESTAMP#,
      test_status = #record.testStatus:CHAR#
    <isParameterPresent >
      <include refid="PBS_TEST_REPORT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
    update PBS_TEST_REPORT
    <dynamic prepend="set" >
      <isNotNull prepend="," property="pbsApplyId" >
        pbs_apply_id = #pbsApplyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testReportNumber" >
        test_report_number = #testReportNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testUserName" >
        test_user_name = #testUserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="testDate" >
        test_date = #testDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="testStatus" >
        test_status = #testStatus:CHAR#
      </isNotNull>
    </dynamic>
    where pbs_test_report_id = #pbsTestReportId:VARCHAR#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.tyust.bean.pbs.PbsTestReport" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update PBS_TEST_REPORT
    SET   pbs_apply_id = #pbsApplyId:VARCHAR#,
	      test_report_number = #testReportNumber:VARCHAR#,
	      test_user_name = #testUserName:VARCHAR#,
	      test_date = #testDate:TIMESTAMP#,
	      test_status = #testStatus:CHAR#,
	      PBS_TEST_SAMPLE_NAME = #pbsTestSampleName:VARCHAR#,
		  PBS_TEST_TYPE_SPECIFICATION	= #pbsTestTypeSpecification:VARCHAR#,
		  PBS_TEST_TEMPERATURE	= #pbsTestTemperature:VARCHAR#,
		  PBS_TEST_HUMIDITY	= #pbsTestHumidity:VARCHAR#,
		  PBS_TEST_PROJECT	= #pbsTestProject:VARCHAR#,
		  PBS_TEST_STANDARD	= #pbsTestStandard:VARCHAR#,
		  PBS_TEST_LOCATION	= #pbsTestLocation:VARCHAR#,
		  PBS_TEST_GRADE	= #pbsTestGrade:VARCHAR#,	
		  PBS_TEST_CONCLUSION	= #pbsTestConclusion:VARCHAR#,
		  PBS_TEST_COMPLETION_TIME	= #pbsTestCompletionTime:DATE#,
		  PBS_TEST_PBS_STATUS	= #pbsTestPbsStatus:VARCHAR#,
		  PBS_TEST_PBS_SIZE	= #pbsTestPbsSize:VARCHAR#
	    where pbs_test_report_id = #pbsTestReportId:VARCHAR#
  </update>
  
  <!-- ll 新增的方法 S -->
  	<!-- 查询屏蔽室检测报告编号 -->
  	<select id="ibatorgenerated_selectPbsNum" resultClass="String" >
	    select NVL(max(SUBSTR(TEST_REPORT_NUMBER,14,3)),'000') from PBS_TEST_REPORT where LENGTH(TEST_REPORT_NUMBER)=16
	</select>
	
	<!-- 根据屏蔽室检测报告ID删除屏蔽室检测仪器信息 -->
	<delete id="deleteTestInsByReportId" parameterClass="String" >	    
	    delete from PBS_TEST_INSTRUMENT
	    where pbs_test_report_id = #value:VARCHAR#
	</delete>
	
	<!-- 向屏蔽室检测仪器表中插入数据 -->
	<insert id="insertTestInstrument" parameterClass="com.tyust.bean.pbs.PbsTestInstrument" >
	    <!--
	      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
	    -->
	    insert into PBS_TEST_INSTRUMENT (PTI_id, PBS_TEST_REPORT_ID, INSTRUMENT_ID)
	    values (#ptiId:VARCHAR#, #pbsTestReportId:VARCHAR#, #instrumentId:VARCHAR#)
	  </insert>
	
	<!-- 根据屏蔽室检测报告ID删除屏蔽室检测数据信息 -->
	<delete id="deleteTestDatasByReportId" parameterClass="String" >	    
	    delete from PBS_TEST_DATAS
	    where pbs_test_report_id = #value:VARCHAR#
	</delete>
	
	<!-- 向屏蔽室检测仪器表中插入数据 -->
	<insert id="insertTestDatas" parameterClass="com.tyust.bean.pbs.PbsTestDatas" >
	    <!--
	      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
	    -->
	    insert into PBS_TEST_DATAS (DATAS_ID, PBS_TEST_REPORT_ID, PBS_TEST_SHIELD,
	    DATAS_14K_HZ,DATAS_100K_HZ,DATAS_450K_HZ,DATAS_950K_HZ,DATAS_6G_HZ)
	    values (#datasId:VARCHAR#, #pbsTestReportId:VARCHAR#, #pbsTestShield:VARCHAR#,
	    #datas14kHz:VARCHAR#, #datas100kHz:VARCHAR#, #datas450kHz:VARCHAR#,
	    #datas950kHz:VARCHAR#, #datas6gHz:VARCHAR#)
	 </insert>
	 
	 <!-- 根据屏蔽室检测报告ID查询检测仪器信息 -->
	 <select id="getPbsInsInfoListByReportId" parameterClass="String" resultClass="com.tyust.bean.app.InstrumentInfo">
	 	select INSTRUMENT_ID as InstrumentId,Name,MODEL as Model,CODE as Code,MANUFACTURER as Manufacturer from NT_INSTRUMENT_INFO where INSTRUMENT_ID in (select INSTRUMENT_ID from PBS_TEST_INSTRUMENT where PBS_TEST_REPORT_ID=#value#)
	 </select>	 
	 
	 <!-- 根据检测报告ID查询检测数据信息 -->
	 <select id="getPbsTestDatasByReportId" parameterClass="String" resultClass="com.tyust.bean.pbs.PbsTestDatas">
	 	select DATAS_ID AS datasId,
			PBS_TEST_REPORT_ID AS pbsTestReportId,
			PBS_TEST_SHIELD	AS pbsTestShield,
			DATAS_14K_HZ	AS datas14kHz,
			DATAS_100K_HZ	AS datas100kHz,
			DATAS_450K_HZ	AS datas450kHz,
			DATAS_950K_HZ	AS datas950kHz,
			DATAS_6G_HZ		AS datas6gHz
			from
      	PBS_TEST_DATAS where PBS_TEST_REPORT_ID = #value#
	 </select>
	 
	 <!-- 根据申请编号查询屏蔽室申请单位信息 -->
	 <select id="getPbsApplyUnitNameByApplyId" parameterClass="String" resultClass="String">
	 	SELECT 
	    UNIT_NAME
	    FROM T_BASE_UNIT_INFO ,PBS_APPLY_INFO
     	WHERE T_BASE_UNIT_INFO.UNIT_ID = PBS_APPLY_INFO.PBS_APPLY_UNIT_ID and PBS_APPLY_INFO.PBS_APPLY_ID = #value#
	 </select>
  <!-- ll 新增的方法 E -->
  
</sqlMap>