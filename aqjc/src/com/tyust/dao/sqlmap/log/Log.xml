<?xml version = "1.0" encoding = "UTF-8"?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="Log"> 
<typeAlias alias="Log" type="com.tyust.bean.log.Log" /> 

<resultMap id="selectLog" class="Log">
		<result property="logId" column="ID"/>
		<result property="actionType" column="ACTION_TYPE" />
		<result property="actionPeopre" column="ACTION_PEOPRE" />
		<result property="actionUnit" column="ACTION_UNIT"/>		
		<result property="actionDate" column="ACTION_DATE"/>
		<result property="actionResult" column="ACTION_RESULT"/>
		<result property="ip" column="IP"/>
		<result property="opeprateObject" column="OPERATE_OBJECT"/>
	</resultMap>
<!-- 
<insert id="insertLog" parameterClass="Log">
	 	insert into LOG_OPERATE(ID,ACTION_TYPE,ACTION_PEOPRE,ACTION_UNIT,ACTION_RESULT,IP,OPERATE_OBJECT)
	           values(#logId#,#actionType#,#actionPeopre#,#actionUnit#,#actionResult#,#ip#,#opeprateObject#)
</insert>
 -->	
  <insert id="insertLog" parameterClass="Log" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into LOG_OPERATE
    <dynamic prepend="(" >
      <isNotNull prepend="," property="logId" >
        ID
      </isNotNull>
      <isNotNull prepend="," property="actionType" >
        ACTION_TYPE
      </isNotNull>
      <isNotNull prepend="," property="actionPeopre" >
        ACTION_PEOPRE
      </isNotNull>
      <isNotNull prepend="," property="actionUnit" >
        ACTION_UNIT
      </isNotNull>
      <isNotNull prepend="," property="actionResult" >
        ACTION_RESULT
      </isNotNull>
      <isNotNull prepend="," property="ip" >
        IP
      </isNotNull>
      <isNotNull prepend="," property="opeprateObject" >
        OPERATE_OBJECT
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="logId" >
        #logId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="actionType" >
        #actionType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="actionPeopre" >
        #actionPeopre:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="actionUnit" >
        #actionUnit:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="actionResult" >
        #actionResult:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ip" >
        #ip:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="opeprateObject" >
        #opeprateObject:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>	
	<select id="sqlserver_selLog" parameterClass="java.util.HashMap"
		resultMap="selectLog">
			SELECT top $limit$ ID, ACTION_TYPE,ACTION_PEOPRE,ACTION_UNIT,ACTION_DATE,ACTION_RESULT,IP,OPERATE_OBJECT 
			FROM LOG_OPERATE where id not in  (select top $start$ id from LOG_OPERATE order by ACTION_DATE DESC) 
		<isNotNull prepend="and" property="actionType">
			ACTION_TYPE=#actionType#
		</isNotNull>
		<isNotNull prepend="and" property="actionPeopre">
			 ACTION_PEOPRE=#actionPeopre# and
		</isNotNull>
		<isNotNull prepend="and" property="startTime">
		<![CDATA[
	   		ACTION_DATE >= #startTime# 
	 	]]>
		</isNotNull>
		<isNotNull prepend="and" property="endTime">
		<![CDATA[
	   		ACTION_DATE  <= #endTime#
	    ]]>
		</isNotNull>
		<![CDATA[
			order by $sortname$ $sortorder$
		]]>
	</select>	
	
	<select id="selLog" parameterClass="java.util.HashMap"
		resultMap="selectLog">
			SELECT ID, ACTION_TYPE,ACTION_PEOPRE,ACTION_UNIT,ACTION_DATE,ACTION_RESULT,IP,OPERATE_OBJECT FROM 
			(
			SELECT A.*, ROWNUM RN 
			FROM (select * from LOG_OPERATE order by ACTION_DATE DESC) A 
			WHERE 
		<isNotNull property="actionType">
			ACTION_TYPE=#actionType# and
		</isNotNull>
		<isNotNull property="actionPeopre">
			 ACTION_PEOPRE=#actionPeopre# and
		</isNotNull>
		<isNotNull property="startTime">
		<![CDATA[
	   		ACTION_DATE >= #startTime#  and
	 	]]>
		</isNotNull>
		<isNotNull property="endTime">
		<![CDATA[
	   		ACTION_DATE  <= #endTime# and
	    ]]>
		</isNotNull>
		<![CDATA[
			ROWNUM <= #end# 
			)
			WHERE RN > #start# order by $sortname$ $sortorder$
		]]>
	</select>
	
	<statement id="countLog" resultClass="int" parameterClass="java.util.HashMap">
			select count(1) from  LOG_OPERATE where ID is not null
		<isNotNull property="actionType">
		and	ACTION_TYPE=#actionType# 
		</isNotNull>
		<isNotNull property="actionPeopre">
		and	ACTION_PEOPRE=#actionPeopre# 
		</isNotNull>
		<isNotNull property="startTime">
		<![CDATA[
	   	and	ACTION_DATE >= #startTime#  
	 	]]>
		</isNotNull>
		<isNotNull property="endTime">
		<![CDATA[
	   		and ACTION_DATE  <= #endTime# 
	    ]]>
		</isNotNull>
	</statement>
	
	<delete id="deleteLog">
		delete from LOG_OPERATE where ID=#logId#
	</delete>
</sqlMap>