<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="module">
	  <typeAlias alias="Basemodule" type="com.tyust.bean.user.TBaseDefinedUrl"/>
	  <resultMap id="moduleResult" class="Basemodule">
	    <result property="id" column="id"/>
	    <result property="moduleId" column="module_id"/>
	    <result property="moduleName" column="module_name"/>
	    <result property="moduleUrl" column="module_url"/>
	    <result property="menuClass" column="menu_class"/>
	  </resultMap>
	  
	   <resultMap id="moduleResult1" class="Basemodule">
	    <result property="id" column="ID"/>
	    <result property="moduleId" column="MODULE_ID"/>
	    <result property="moduleName" column="MODULE_NAME"/>
	    <result property="moduleUrl" column="MODULE_URL"/>
	    <result property="inuse" column="INUSE"/>
	    <result property="sortNo" column="SORT_NO"/>
	    <result property="menuClass" column="MENU_CLASS"/>
	    <result property="memo1" column="MEMO1"/>
	  </resultMap>
	  
	  <!-- 修改  去除：（and memo2 !=#memo2#）职务选择 -->
	  <select id="selectAllmodule" resultMap="moduleResult" parameterClass="String">
	    	SELECT ID,MODULE_ID,MODULE_NAME,MODULE_URL,MENU_CLASS FROM T_BASE_DEFINED_URL 
	    	WHERE INUSE = 1 AND FLAG = 0  ORDER BY MODULE_ID,SORT_NO
	  </select>
	  <!--  
	  <insert id="insertModule" parameterClass="Basemodule">
	  INSERT INTO T_BASE_DEFINED_URL(ID,MODULE_ID,MODULE_NAME,MODULE_URL,MEMO1,MEMO2,INUSE,SORT_NO,MENU_CLASS,FLAG)
	   VALUES (#id#,#moduleId#,#moduleName#,#moduleUrl#,#memo1#,#memo2#,#inuse#,#sortNo#,#menuClass#,#flag#)
	  </insert>
	  -->
	    <insert id="insertModule" parameterClass="Basemodule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into T_BASE_DEFINED_URL
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        ID
      </isNotNull>
      <isNotNull prepend="," property="moduleId" >
        MODULE_ID
      </isNotNull>
      <isNotNull prepend="," property="moduleName" >
        MODULE_NAME
      </isNotNull>
      <isNotNull prepend="," property="moduleUrl" >
        MODULE_URL
      </isNotNull>
      <isNotNull prepend="," property="memo1" >
        MEMO1
      </isNotNull>
      <isNotNull prepend="," property="memo2" >
        MEMO2
      </isNotNull>
      <isNotNull prepend="," property="inuse" >
        INUSE
      </isNotNull>
      <isNotNull prepend="," property="sortNo" >
        SORT_NO
      </isNotNull>
      <isNotNull prepend="," property="menuClass" >
        MENU_CLASS
      </isNotNull>
      <isNotNull prepend="," property="flag" >
        FLAG
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="moduleId" >
        #moduleId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="moduleName" >
        #moduleName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="moduleUrl" >
        #moduleUrl:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memo1" >
        #memo1:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memo2" >
        #memo2:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="inuse" >
        #inuse:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sortNo" >
        #sortNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="menuClass" >
        #menuClass:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="flag" >
        #flag:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
	  <update id="updateModule" parameterClass="Basemodule">
	    UPDATE T_BASE_DEFINED_URL SET 
	    MODULE_NAME = #moduleName#,
	    MODULE_URL = #moduleUrl#,
	    MEMO1 = #memo1#,
	    INUSE = #inuse#,
	    SORT_NO = #sortNo#
	      WHERE MODULE_ID = #moduleId#
	  </update>
	  
	  <delete id="sqlserver_deleteModule" parameterClass="Basemodule">
	    UPDATE T_BASE_DEFINED_URL SET FLAG = -1 WHERE MODULE_ID LIKE #moduleId#+'%' 
	  </delete>
	   <delete id="deleteModule" parameterClass="Basemodule">
	    UPDATE T_BASE_DEFINED_URL SET FLAG = -1 WHERE MODULE_ID LIKE #moduleId#||'%' 
	  </delete>
	   <!--  -->
	  <select id="sqlsever_selectModuleByUpid" parameterClass="string" resultMap="moduleResult1">
	   SELECT ID,MODULE_ID,MODULE_NAME,MODULE_URL,MEMO1,INUSE,SORT_NO,MENU_CLASS
	    FROM T_BASE_DEFINED_URL WHERE MODULE_ID LIKE #moduleId#+'%' AND len(MODULE_ID)=len(#moduleId#)+3 AND FLAG = 0 ORDER BY SORT_NO,MODULE_ID
	  </select>
	  
	   <select id="selectModuleByUpid" parameterClass="string" resultMap="moduleResult1">
	   SELECT ID,MODULE_ID,MODULE_NAME,MODULE_URL,MEMO1,INUSE,SORT_NO,MENU_CLASS
	    FROM T_BASE_DEFINED_URL WHERE MODULE_ID LIKE #moduleId#||'%' AND length(MODULE_ID)=length(#moduleId#)+3 AND FLAG = 0 ORDER BY SORT_NO,MODULE_ID
	  </select>
	  
	  <select id="sqlsever_selectMenu" resultMap="moduleResult1">
	  SELECT ID,MODULE_ID,MODULE_NAME,MODULE_URL,MEMO1,INUSE,SORT_NO,MENU_CLASS
	  FROM T_BASE_DEFINED_URL WHERE len(MODULE_ID)=3  AND FLAG = 0 ORDER BY MODULE_ID
	  </select>
	  
	  <select id="selectMenu" resultMap="moduleResult1">
	  SELECT ID,MODULE_ID,MODULE_NAME,MODULE_URL,MEMO1,INUSE,SORT_NO,MENU_CLASS
	  FROM T_BASE_DEFINED_URL WHERE length(MODULE_ID)=3  AND FLAG = 0 ORDER BY MODULE_ID
	  </select>
	  
	  <select id="sqlsever_selectMaxMenuId" resultClass="string">
	  SELECT MAX(MODULE_ID) FROM T_BASE_DEFINED_URL WHERE len(MODULE_ID)=3 
	  </select>
	  
	  <select id="selectMaxMenuId" resultClass="string">
	  SELECT MAX(MODULE_ID) FROM T_BASE_DEFINED_URL WHERE length(MODULE_ID)=3 
	  </select>
	  
	  <select id="sqlserver_selectMaxModuleId" resultClass="string" parameterClass="string">
	   SELECT MAX(MODULE_ID) FROM T_BASE_DEFINED_URL WHERE MODULE_ID LIKE #moduleId#+'%' AND len(MODULE_ID)=len(#moduleId#)+3 
	  </select>
	  
	  <select id="selectMaxModuleId" resultClass="string" parameterClass="string">
	   SELECT MAX(MODULE_ID) FROM T_BASE_DEFINED_URL WHERE MODULE_ID LIKE #moduleId#||'%' AND length(MODULE_ID)=length(#moduleId#)+3 
	  </select>
	  
	  <select id="selectModuleByuserId" parameterClass="string" resultMap="moduleResult">
	  SELECT 
      ID,MODULE_ID,MODULE_NAME,MODULE_URL,MENU_CLASS
      FROM T_BASE_DEFINED_URL WHERE MODULE_ID not like '014%' and INUSE = 1 AND FLAG = 0 AND MODULE_ID IN (
      SELECT MODULE_ID FROM T_BASE_UNIT_ROLE_MODULE WHERE ROLE_ID IN (
      SELECT ROLE_ID FROM T_BASE_UNIT_USER_ROLE WHERE USER_ID = #userId#
      )
      ) ORDER BY MODULE_ID
	  </select>
	  
	  <!-- 查询角色拥有的权限 -->
	 <select id="selectModuleByRoleId" parameterClass="string" resultMap="moduleResult">
	  SELECT 
      ID,MODULE_ID,MODULE_NAME,MODULE_URL,MENU_CLASS
      FROM T_BASE_DEFINED_URL WHERE INUSE = 1 AND FLAG = 0 AND MODULE_ID IN (
      SELECT MODULE_ID FROM T_BASE_UNIT_ROLE_MODULE WHERE ROLE_ID IN (
      SELECT ROLE_ID FROM T_BASE_UNIT_USER_ROLE WHERE USER_ID = #userId#
      )
      ) ORDER BY MODULE_ID
	  </select>
	  
	  <select id="selectVirtualModuleByuserId" parameterClass="string" resultMap="moduleResult">
	  SELECT 
      ID,MODULE_ID,MODULE_NAME,MODULE_URL,MENU_CLASS
      FROM T_BASE_DEFINED_URL WHERE MODULE_ID like '013%' and INUSE = 1 AND FLAG = 0 AND MODULE_ID IN (
      SELECT MODULE_ID FROM T_BASE_UNIT_ROLE_MODULE WHERE ROLE_ID IN (
      SELECT ROLE_ID FROM T_BASE_UNIT_USER_ROLE WHERE USER_ID = #userId#
      )
      ) ORDER BY MODULE_ID
	  </select>
</sqlMap>
