<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="T_DEVICE_BASE_INFO" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR" />
    <result column="DEVICE_NAME" property="deviceName" jdbcType="VARCHAR" />
    <result column="DEVICE_MODEL" property="deviceModel" jdbcType="VARCHAR" />
    <result column="DEVICE_NUM" property="deviceNum" jdbcType="VARCHAR" />
    <result column="DEVICE_TYPE" property="deviceType" jdbcType="VARCHAR" />
    <result column="UNIT_NAME" property="unitName" jdbcType="VARCHAR" />
    <result column="UNIT_ID" property="unitId" jdbcType="VARCHAR" />
    <result column="MEMO" property="memo" jdbcType="VARCHAR" />
    <result column="DEVICE_TYPE_NAME" property="deviceTypeName" jdbcType="VARCHAR" />
    <result column="DEVICE_LABEL" property="deviceLabel" jdbcType="VARCHAR" />
    <result column="DEVICE_CLASS" property="deviceClass" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tyust.bean.app.DeviceBaseInfoExample" >
    select DEVICE_ID, DEVICE_NAME, DEVICE_MODEL, DEVICE_NUM, DEVICE_TYPE, UNIT_NAME, UNIT_ID, MEMO,
      DEVICE_TYPE_NAME, DEVICE_LABEL, DEVICE_CLASS, REMARK
    from T_DEVICE_BASE_INFO
    <isParameterPresent >
      <include refid="T_DEVICE_BASE_INFO.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    select DEVICE_ID, DEVICE_NAME, DEVICE_MODEL, DEVICE_NUM, DEVICE_TYPE, UNIT_NAME, UNIT_ID, MEMO,
      DEVICE_TYPE_NAME, DEVICE_LABEL, DEVICE_CLASS, REMARK
    from T_DEVICE_BASE_INFO
    where DEVICE_ID = #deviceId:VARCHAR#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from T_DEVICE_BASE_INFO
    where DEVICE_ID = #deviceId:VARCHAR#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.tyust.bean.app.DeviceBaseInfoExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from T_DEVICE_BASE_INFO
    <include refid="T_DEVICE_BASE_INFO.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into T_DEVICE_BASE_INFO (DEVICE_ID, DEVICE_NAME, DEVICE_MODEL, DEVICE_NUM, DEVICE_TYPE,
      UNIT_NAME, UNIT_ID, MEMO, DEVICE_TYPE_NAME, DEVICE_LABEL, DEVICE_CLASS, REMARK)
    values (#deviceId:VARCHAR#, #deviceName:VARCHAR#, #deviceModel:VARCHAR#, #deviceNum:VARCHAR#,
      #deviceType:VARCHAR#, #unitName:VARCHAR#, #unitId:VARCHAR#, #memo:VARCHAR#,
      #deviceTypeName:VARCHAR#, #deviceLabel:VARCHAR#, #deviceClass:VARCHAR#, #remark:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into T_DEVICE_BASE_INFO
    <dynamic prepend="(" >
      <isNotNull prepend="," property="deviceId" >
        DEVICE_ID
      </isNotNull>
      <isNotNull prepend="," property="deviceName" >
        DEVICE_NAME
      </isNotNull>
      <isNotNull prepend="," property="deviceModel" >
        DEVICE_MODEL
      </isNotNull>
      <isNotNull prepend="," property="deviceNum" >
        DEVICE_NUM
      </isNotNull>
      <isNotNull prepend="," property="deviceType" >
        DEVICE_TYPE
      </isNotNull>
      <isNotNull prepend="," property="unitName" >
        UNIT_NAME
      </isNotNull>
      <isNotNull prepend="," property="unitId" >
        UNIT_ID
      </isNotNull>
      <isNotNull prepend="," property="memo" >
        MEMO
      </isNotNull>
      <isNotNull prepend="," property="deviceTypeName" >
        DEVICE_TYPE_NAME
      </isNotNull>
      <isNotNull prepend="," property="deviceLabel" >
        DEVICE_LABEL
      </isNotNull>
      <isNotNull prepend="," property="deviceClass" >
        DEVICE_CLASS
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="deviceId" >
        #deviceId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceName" >
        #deviceName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceModel" >
        #deviceModel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceNum" >
        #deviceNum:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceType" >
        #deviceType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="unitName" >
        #unitName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="unitId" >
        #unitId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memo" >
        #memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceTypeName" >
        #deviceTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceLabel" >
        #deviceLabel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceClass" >
        #deviceClass:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        #remark:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.tyust.bean.app.DeviceBaseInfoExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select count(*) from T_DEVICE_BASE_INFO
    <include refid="T_DEVICE_BASE_INFO.ibatorgenerated_Example_Where_Clause" />
  </select>
  
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update T_DEVICE_BASE_INFO
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.deviceId" >
        DEVICE_ID = #record.deviceId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceName" >
        DEVICE_NAME = #record.deviceName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceModel" >
        DEVICE_MODEL = #record.deviceModel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceNum" >
        DEVICE_NUM = #record.deviceNum:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceType" >
        DEVICE_TYPE = #record.deviceType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.unitName" >
        UNIT_NAME = #record.unitName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.unitId" >
        UNIT_ID = #record.unitId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.memo" >
        MEMO = #record.memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceTypeName" >
        DEVICE_TYPE_NAME = #record.deviceTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceLabel" >
        DEVICE_LABEL = #record.deviceLabel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceClass" >
        DEVICE_CLASS = #record.deviceClass:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.remark" >
        REMARK = #record.remark:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="T_DEVICE_BASE_INFO.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update T_DEVICE_BASE_INFO
    set DEVICE_ID = #record.deviceId:VARCHAR#,
      DEVICE_NAME = #record.deviceName:VARCHAR#,
      DEVICE_MODEL = #record.deviceModel:VARCHAR#,
      DEVICE_NUM = #record.deviceNum:VARCHAR#,
      DEVICE_TYPE = #record.deviceType:VARCHAR#,
      UNIT_NAME = #record.unitName:VARCHAR#,
      UNIT_ID = #record.unitId:VARCHAR#,
      MEMO = #record.memo:VARCHAR#,
      DEVICE_TYPE_NAME = #record.deviceTypeName:VARCHAR#,
      DEVICE_LABEL = #record.deviceLabel:VARCHAR#,
      DEVICE_CLASS = #record.deviceClass:VARCHAR#,
      REMARK = #record.remark:VARCHAR#
    <isParameterPresent >
      <include refid="T_DEVICE_BASE_INFO.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update T_DEVICE_BASE_INFO
    <dynamic prepend="set" >
      <isNotNull prepend="," property="deviceName" >
        DEVICE_NAME = #deviceName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceModel" >
        DEVICE_MODEL = #deviceModel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceNum" >
        DEVICE_NUM = #deviceNum:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceType" >
        DEVICE_TYPE = #deviceType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="unitName" >
        UNIT_NAME = #unitName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="unitId" >
        UNIT_ID = #unitId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="memo" >
        MEMO = #memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceTypeName" >
        DEVICE_TYPE_NAME = #deviceTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceLabel" >
        DEVICE_LABEL = #deviceLabel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceClass" >
        DEVICE_CLASS = #deviceClass:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
    </dynamic>
    where DEVICE_ID = #deviceId:VARCHAR#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.tyust.bean.app.DeviceBaseInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update T_DEVICE_BASE_INFO
    set DEVICE_NAME = #deviceName:VARCHAR#,
      DEVICE_MODEL = #deviceModel:VARCHAR#,
      DEVICE_NUM = #deviceNum:VARCHAR#,
      DEVICE_TYPE = #deviceType:VARCHAR#,
      UNIT_NAME = #unitName:VARCHAR#,
      UNIT_ID = #unitId:VARCHAR#,
      MEMO = #memo:VARCHAR#,
      DEVICE_TYPE_NAME = #deviceTypeName:VARCHAR#,
      DEVICE_LABEL = #deviceLabel:VARCHAR#,
      DEVICE_CLASS = #deviceClass:VARCHAR#,
      REMARK = #remark:VARCHAR#
    where DEVICE_ID = #deviceId:VARCHAR#
  </update>
  
  	<select id="selApplyDve" parameterClass="java.lang.String" resultMap="ibatorgenerated_BaseResultMap" >
	  select ad.id as MEMO,ad.DEVICE_ID, DEVICE_NAME, DEVICE_MODEL, DEVICE_NUM, DEVICE_TYPE, UNIT_NAME, UNIT_ID, 
      DEVICE_TYPE_NAME, dbi.DEVICE_LABEL, dbi.DEVICE_CLASS, dbi.REMARK
      from NT_APPLY_DEVICE ad left join T_DEVICE_BASE_INFO dbi on (ad.DEVICE_ID = dbi.DEVICE_ID)
      where ad.APPLY_ID=#applyId# order by to_number(dbi.remark) ASC
	</select>
	
	<delete id="delApplyDve" parameterClass="java.lang.String" >
     delete from t_device_base_info 
    	where device_id in 
    	    (select device_id from nt_apply_device where apply_id =#applyId#)
   </delete>
  
	<select id="countDevice" parameterClass="com.tyust.bean.app.DeviceBaseInfo" resultClass="java.lang.Integer" >
	select count(*) from(
	SELECT da.DEVICE_ID as DEVICE_ID,
    da.APPLY_ID as DEVICE_NUM,
    da.DEVICE_NAME,
    DEVICE_MODEL,
    DEVICE_TYPE,
    UNIT_NAME,
    UNIT_ID,
    MEMO,
    DEVICE_TYPE_NAME,
    DEVICE_LABEL,
    DEVICE_CLASS,
  TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') as REMARK,
  ROWNUM RN
FROM
  (SELECT dbi.DEVICE_ID,
    ad.APPLY_ID,
    dbi.DEVICE_NAME,
    DEVICE_MODEL,
    DEVICE_TYPE,
    UNIT_NAME,
    UNIT_ID,
    MEMO,
    DEVICE_TYPE_NAME,
    DEVICE_LABEL,
    dic.dictionary_option_name as DEVICE_CLASS
  FROM T_DEVICE_BASE_INFO dbi,
    NT_APPLY_DEVICE ad,DIC_SYSTEM_DICTIONARY dic
  WHERE ad.DEVICE_ID = dbi.DEVICE_ID AND dbi.DEVICE_CLASS = dic.DICTIONARY_OPTION_ID
 <dynamic>
  <isNotEmpty prepend="AND" property="deviceClass">
			dbi.device_class = #deviceClass:VARCHAR#
		</isNotEmpty>
	</dynamic>
  ) da ,
  NT_DEVICE_TEST_REPORT dtr
  WHERE da.APPLY_ID = dtr.APPLY_ID
	<dynamic>
		<isNotEmpty prepend="AND" property="unitName">
			 UNIT_NAME like '%$unitName$%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceType">
			device_type = #deviceType:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceLabel">
			<![CDATA[
				TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') >= #deviceLabel:VARCHAR#
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceTypeName">
			<![CDATA[
				TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') <= #deviceTypeName:VARCHAR#
			]]>
		</isNotEmpty>
		</dynamic>
	order by dtr.test_date desc
    )
	</select>
	
	
	<select id="selDevice" parameterClass="com.tyust.bean.app.DeviceBaseInfo" resultMap="ibatorgenerated_BaseResultMap" >
	select * from(
	SELECT da.DEVICE_ID as DEVICE_ID,
    da.APPLY_ID as DEVICE_NUM,
    da.DEVICE_NAME,
    DEVICE_MODEL,
    DEVICE_TYPE,
    UNIT_NAME,
    UNIT_ID,
    MEMO,
    DEVICE_TYPE_NAME,
    DEVICE_LABEL,
    DEVICE_CLASS,
  TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') as REMARK,
  ROWNUM RN
FROM
  (SELECT dbi.DEVICE_ID,
    ad.APPLY_ID,
    dbi.DEVICE_NAME,
    DEVICE_MODEL,
    DEVICE_TYPE,
    UNIT_NAME,
    UNIT_ID,
    MEMO,
    DEVICE_TYPE_NAME,
    DEVICE_LABEL,
    dic.dictionary_option_name as DEVICE_CLASS
  FROM T_DEVICE_BASE_INFO dbi,
    NT_APPLY_DEVICE ad,DIC_SYSTEM_DICTIONARY dic
  WHERE ad.DEVICE_ID = dbi.DEVICE_ID AND dbi.DEVICE_CLASS = dic.DICTIONARY_OPTION_ID
 <dynamic>
  <isNotEmpty prepend="AND" property="deviceClass">
			dbi.device_class = #deviceClass:VARCHAR#
		</isNotEmpty>
	</dynamic>
  ) da ,
  NT_DEVICE_TEST_REPORT dtr
WHERE da.APPLY_ID = dtr.APPLY_ID
	<dynamic>
		<isNotEmpty prepend="AND" property="unitName">
			 UNIT_NAME like '%$unitName$%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceType">
			device_type = #deviceType:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceLabel">
			<![CDATA[
				TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') >= #deviceLabel:VARCHAR#
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deviceTypeName">
			<![CDATA[
				TO_CHAR(dtr.TEST_DATE,'yyyy-MM-dd') <= #deviceTypeName:VARCHAR#
			]]>
		</isNotEmpty>
		</dynamic>
	order by dtr.test_date desc
 )
	<dynamic>
		<isNotEmpty property="memo">
			WHERE RN BETWEEN #memo:VARCHAR# AND #remark:VARCHAR#
		</isNotEmpty>
	</dynamic>
	
	</select>
  
</sqlMap>